# Global options
{
    admin off # No admin API needed in Railway's environment
    persist_config off # Storage isn't persistent
    auto_https off # Railway handles HTTPS for us

    # Runtime logs
    log {
        format json # Set runtime log format to JSON
    }

    # Server options
    servers {
        trusted_proxies static private_ranges 100.0.0.0/8 # Trust Railway's proxy
    }
}

# Front-end (React) site block
:{$PORT:3000} {
    # Access logs
    log {
        format json # Set access log format to JSON
    }

    # Health check for Railway
    rewrite /health /*

    # Serve from the 'dist' folder (Vite builds into 'dist')
    root * ./Client/dist

    # Enable gzipping responses
    encode gzip

    # Serve files from 'dist'
    file_server

    # Handle client-side routing (React Router)
    try_files {path} /index.html
}

# Back-end (PHP) site block
:{$PORT_BACKEND:3001} {
    # Access logs
    log {
        format json # Set access log format to JSON
    }

    # Health check for Railway
    rewrite /health /*

    # Serve PHP application
    root * ./Server/public

    # Use PHP-FPM for dynamic requests
    php_fastcgi unix//var/run/php/php-fpm.sock

    # Enable gzipping responses
    encode gzip

    # Serve static files
    file_server
}
